<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>POPs ‚Äì CIAD / CICOP</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<style>
:root{
  /* Identidade Visual */
  --pm-blue: #003366;       
  --pm-dark: #001a33;       
  --pm-light: #e6f0ff;      
  --pm-focus: #0044cc;      
  --pm-bg: #f4f6f9;         
  --pm-alert: #ffc107;      
  --pm-danger: #dc3545;     
}

body {
  font-family: 'Source Sans Pro', sans-serif;
  background: var(--pm-bg);
  height: 100vh;
  overflow: hidden; 
  display: flex;
  flex-direction: column;
}

/* --- HEADER --- */
.top-header {
    height: 45px;
    background-color: var(--pm-blue);
    background-image: linear-gradient(to right, #003366, #004080);
    color: white;
    display: flex;
    align-items: center;
    padding: 0 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    z-index: 1000;
    flex-shrink: 0;
}

.logo-top {
    height: 32px;
    width: auto;
    margin-right: 10px;
}

.brand-area { display: flex; align-items: center; gap: 10px; font-size: 1rem; font-weight: 700; }
.system-badge { background: rgba(255,255,255,0.15); padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; margin-left: 8px; border: 1px solid rgba(255,255,255,0.2); }

/* --- LAYOUT --- */
#app-root { display: flex; flex: 1; overflow: hidden; }

/* SIDEBAR */
#sidebar { width: 240px; background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; overflow-y: auto; }
.sidebar-section { padding: 12px 15px 4px 15px; font-size: 0.8rem; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
#sidebar .nav-link { color: #555; padding: 8px 15px; font-weight: 600; cursor: pointer; border-left: 3px solid transparent; transition: 0.2s; font-size: 0.9rem; display: flex; align-items: center; text-decoration: none; }
#sidebar .nav-link i { margin-right: 8px; font-size: 1rem; width: 20px; text-align: center; }
#sidebar .nav-link:hover { background: var(--pm-light); color: var(--pm-blue); }
#sidebar .nav-link.active { background: #dceeff; color: var(--pm-blue); border-left-color: var(--pm-focus); }

/* MAIN CONTENT */
#main-content { 
    flex: 1; 
    padding: 10px; 
    background: var(--pm-bg); 
    overflow: hidden; 
    display: flex;
    flex-direction: column;
}

/* --- ESTILOS DA TRIAGEM --- */

/* SCRIPT PANEL */
.script-panel { flex: 2.2; background: white; border-radius: 6px; display: flex; flex-direction: column; box-shadow: 0 1px 4px rgba(0,0,0,0.05); border: 1px solid #e0e6ed; overflow: hidden; height: 100%; }
.script-header { background: #f8f9fa; color: var(--pm-blue); padding: 8px 15px; font-size: 0.95rem; font-weight: 700; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; height: 40px; flex-shrink: 0;}
.script-body { padding: 15px; overflow-y: auto; flex: 1; position: relative; }

/* DATA PANEL */
.data-panel { flex: 1; background: white; border: 1px solid #e0e6ed; border-radius: 6px; padding: 10px; display: flex; flex-direction: column; box-shadow: 0 1px 4px rgba(0,0,0,0.05); height: 100%; }

/* COMPONENTES VISUAIS DA TRIAGEM */
.command-card { border-left: 4px solid var(--pm-focus); padding: 15px; border-radius: 5px; background: #fff; border: 1px solid #eee; border-left-width: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.02); margin-bottom: 15px; }
.command-text { font-size: 1.2rem; font-weight: 700; color: var(--pm-blue); margin-bottom: 10px; line-height: 1.2; }
.command-hint { font-size: 0.9rem; color: #333; line-height: 1.5; }
.command-hint ul { padding-left: 20px; margin-bottom: 10px; margin-top: 5px; }
.system-alert { background: #fff3cd; border: 1px solid #ffeeba; border-left: 5px solid var(--pm-alert); padding: 10px; border-radius: 5px; font-size: 0.9rem; margin-bottom: 15px; color: #856404; }

/* Bot√µes de Op√ß√£o */
.option-btn { 
    text-align: left; 
    font-weight: 600; 
    padding: 10px 12px; 
    border-radius: 5px; 
    transition: all 0.2s; 
    border: 1px solid #dee2e6; 
    background: #f8f9fa; 
    color: #333; 
    width: 100%; 
    height: 100%; 
    display: flex; 
    align-items: center; 
    font-size: 0.9rem; 
}
.option-btn:hover { background: var(--pm-focus); color: white; border-color: var(--pm-focus); transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.option-btn i { margin-right: 8px; font-size: 1.1rem; }

#notepad { flex: 1; font-family: 'Courier New', monospace; font-size: 0.85rem; border: 1px solid #ced4da; background-color: #fcfcfc; resize: none; color: #333; margin-top: 5px;}
.form-label { margin-bottom: 2px; font-size: 0.75rem; }

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: #f1f1f1; }
::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #aaa; }

footer {
    text-align: center;
    font-size: 0.75rem;
    color: #888;
    margin-top: auto; 
    padding-top: 10px;
    padding-bottom: 5px;
}
</style>
</head>
<body>

<header class="top-header">
    <div class="brand-area w-100 d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <i class="bi bi-shield-shaded me-2" style="font-size: 1.2rem;"></i> 
            <span class="ms-1">CIAD / CICOP</span>
            <span class="system-badge">SISTEMA INTEGRADO</span>
        </div>
        <div class="small opacity-75 fw-normal" style="font-size: 0.75rem;">Procedimentos 2025</div>
    </div>
</header>

<div id="app-root">

    <div id="sidebar">
        <div class="sidebar-section">Menu Principal</div>
    
        <div class="nav flex-column">

            <a href="#" onclick="resetApp()" class="nav-link active" id="link-triagem" title="Atendimento Emerg√™ncia">
                <i class="bi bi-file-earmark-pdf"></i> Triagem 190
            </a>

            <a href="00POPs 2025 TELEATENDIMENTOEDESPACHOSEPARATAnr 60 e12_08_2025.pdf" target="_blank" class="nav-link" title="POP Emerg√™ncia">
                <i class="bi bi-file-text"></i> POP 01 - Emerg√™ncia
            </a>
            
            <a href="POPs - Cicop -POPATENDIMENTOESTRANGEIRO.html" class="nav-link" title="Atendimento Estrangeiro">
                <i class="bi bi-translate"></i> POP 02 - Estrangeiro
            </a>

            <a href="poppm.html" class="nav-link" title="Fluxograma Integrado">
                <i class="bi bi-diagram-3"></i> √Årvore de Decis√£o
            </a>
        </div>

        </div>

    <div id="main-content">
        
        <div id="triagem-view" style="display: flex; height: 100%; gap: 10px;">
            <div class="script-panel">
                <div class="script-header">
                    <span id="view-title">TRIAGEM DE OCORR√äNCIA POLICIAL</span>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary me-1 py-0" onclick="resetApp()" id="btn-reset" title="Reiniciar" style="font-size: 0.8rem;"><i class="bi bi-arrow-clockwise"></i> Reiniciar</button>
                        <button class="btn btn-sm btn-outline-secondary py-0" onclick="backStep()" id="btn-back" style="display:none; font-size: 0.8rem;">‚¨ÖÔ∏è Voltar</button>
                    </div>
                </div>
                <div class="script-body" id="script-flow">
                    </div>
            </div>
    
            <div class="data-panel">
                <div class="d-flex flex-column flex-grow-1">
                    <label class="form-label fw-bold text-danger small text-uppercase">üìù Bloco de Notas (CAD)</label>
                    <textarea id="notepad" class="form-control" placeholder="Hist√≥rico gerado automaticamente..."></textarea>
                </div>
                <div class="d-flex gap-2 mt-2">
                    <button class="btn btn-success btn-sm w-100" onclick="copyNotes()">üìã Copiar</button>
                    <button class="btn btn-outline-danger btn-sm w-100" onclick="clearNotes()">üóë Limpar</button>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
// --- L√ìGICA DA TRIAGEM ---

const appData = {
    history: [], 
    currentView: 'triagem',
    
    // √Årvore de Decis√£o Policial
    treeData: {
        1: {
            question: "Qual √© a situa√ß√£o principal informada pelo solicitante?",
            guidance: "<strong>Objetivo:</strong> Identificar se h√° ind√≠cio de crime, contraven√ß√£o ou apenas inc√¥modo.<br><br><strong>Perguntas-chave:</strong><ul><li>O que exatamente est√° acontecendo agora?</li><li>Isso envolve viol√™ncia, amea√ßa, drogas ou apenas barulho/inc√¥modo?</li></ul>",
            options: [
                { text: "Crime contra patrim√¥nio", next: 2 },
                { text: "Viol√™ncia contra pessoa", next: 10 },
                { text: "Drogas ou atividade suspeita organizada", next: 20 },
                { text: "Crime sexual", next: 30 },
                { text: "Som alto / perturba√ß√£o do sossego", next: 50 },
                { text: "Outro tipo de ocorr√™ncia", next: 99 }
            ]
        },

        /* ===================== CRIMES PATRIMONIAIS ===================== */
        2: {
            question: "Houve uso de viol√™ncia ou amea√ßa contra a v√≠tima?",
            guidance: "<strong>Diferencia Furto x Roubo</strong>",
            options: [
                { text: "N√£o houve viol√™ncia ou amea√ßa", next: 3 },
                { text: "Houve amea√ßa ou viol√™ncia", next: 4 }
            ]
        },
        3: {
            question: "A subtra√ß√£o ocorreu sem contato direto com a v√≠tima?",
            guidance: "Exemplos: celular furtado, resid√™ncia arrombada, objeto retirado sem abordagem.",
            options: [
                { text: "Sim, sem contato com a v√≠tima", next: "RESULT_1" },
                { text: "Tentativa percebida pela v√≠tima", next: "RESULT_1" }
            ]
        },
        4: {
            question: "Houve contato direto com a v√≠tima durante a subtra√ß√£o?",
            guidance: "Inclui amea√ßa, empurr√£o, intimida√ß√£o ou uso de arma.",
            options: [
                { text: "Sim", next: "RESULT_2" }
            ]
        },

        /* ===================== VIOL√äNCIA CONTRA PESSOA ===================== */
        10: {
            question: "A viol√™ncia ocorreu no ambiente familiar ou entre pessoas com v√≠nculo?",
            guidance: "Considerar c√¥njuge, ex-c√¥njuge, companheiro(a), parentes ou conviventes.",
            options: [
                { text: "Sim", next: 11 },
                { text: "N√£o", next: 14 }
            ]
        },
        11: {
            question: "A v√≠tima √© mulher e o agressor possui v√≠nculo √≠ntimo ou familiar?",
            guidance: "Aplica√ß√£o da Lei Maria da Penha.",
            options: [
                { text: "Sim", next: "RESULT_4" },
                { text: "N√£o", next: 12 }
            ]
        },
        12: {
            question: "A v√≠tima √© crian√ßa ou adolescente?",
            guidance: "",
            options: [
                { text: "Sim", next: "RESULT_8" },
                { text: "N√£o", next: 14 }
            ]
        },
        14: {
            question: "Houve morte da v√≠tima?",
            guidance: "",
            options: [
                { text: "Sim", next: 15 },
                { text: "N√£o, apenas agress√£o/amea√ßa", next: 99 }
            ]
        },
        15: {
            question: "A v√≠tima √© mulher e o crime envolve contexto de g√™nero?",
            guidance: "Ci√∫mes, rela√ß√£o afetiva, menosprezo ou discrimina√ß√£o por condi√ß√£o feminina.",
            options: [
                { text: "Sim", next: "RESULT_6" },
                { text: "N√£o", next: "RESULT_5" }
            ]
        },

        /* ===================== DROGAS / CRIME ORGANIZADO ===================== */
        20: {
            question: "H√° ind√≠cios de com√©rcio, transporte ou distribui√ß√£o de drogas?",
            guidance: "Venda, ponto de tr√°fico, grande quantidade ou log√≠stica organizada.",
            options: [
                { text: "Sim", next: "RESULT_3" },
                { text: "N√£o", next: 21 }
            ]
        },
        21: {
            question: "H√° atua√ß√£o de grupo organizado ou fac√ß√£o criminosa?",
            guidance: "Extors√£o, dom√≠nio territorial, armas, organiza√ß√£o criminosa.",
            options: [
                { text: "Sim", next: "RESULT_9" },
                { text: "N√£o", next: 99 }
            ]
        },

        /* ===================== CRIMES SEXUAIS ===================== */
        30: {
            question: "O fato envolve constrangimento sexual ou ato sem consentimento?",
            guidance: "",
            options: [
                { text: "Sim", next: 31 },
                { text: "N√£o", next: 99 }
            ]
        },
        31: {
            question: "A v√≠tima √© crian√ßa ou adolescente?",
            guidance: "",
            options: [
                { text: "Sim", next: "RESULT_8" },
                { text: "N√£o", next: "RESULT_7" }
            ]
        },

        /* ===================== PERTURBA√á√ÉO DO SOSSEGO ===================== */
        50: {
            question: "O inc√¥modo relatado √© causado por som alto, festa, gritaria ou barulho cont√≠nuo?",
            guidance: "Exemplos: som automotivo, festa em resid√™ncia, barulho excessivo.",
            options: [
                { text: "Sim", next: 51 },
                { text: "N√£o, √© outro tipo de inc√¥modo", next: 99 }
            ]
        },
        51: {
            question: "O barulho est√° ocorrendo neste momento?",
            guidance: "Verificar situa√ß√£o de flagrante.",
            options: [
                { text: "Sim, est√° acontecendo agora", next: 52 },
                { text: "N√£o, j√° cessou", next: 55 }
            ]
        },
        52: {
            question: "O barulho √© recorrente ou j√° causou conflito entre vizinhos?",
            guidance: "Avaliar risco de escalada para viol√™ncia.",
            options: [
                { text: "Sim, √© recorrente ou j√° houve discuss√£o", next: 53 },
                { text: "N√£o, √© um evento pontual", next: 54 }
            ]
        },
        53: {
            question: "H√° amea√ßa, agress√£o ou risco de viol√™ncia no local?",
            guidance: "Se houver viol√™ncia, sair do fluxo de sossego.",
            options: [
                { text: "Sim", next: 10 },
                { text: "N√£o", next: "RESULT_50" }
            ]
        },
        54: {
            question: "O solicitante deseja apenas orienta√ß√£o ou interven√ß√£o policial?",
            guidance: "",
            options: [
                { text: "Interven√ß√£o policial no local", next: "RESULT_50" },
                { text: "Apenas orienta√ß√£o", next: "RESULT_51" }
            ]
        },
        55: {
            question: "O solicitante deseja registrar o fato formalmente?",
            guidance: "Sem flagrante, pode n√£o haver deslocamento.",
            options: [
                { text: "Sim", next: "RESULT_52" },
                { text: "N√£o", next: "RESULT_51" }
            ]
        },

        /* ===================== RESULTADOS ===================== */
        "RESULT_1": { result: "Natureza Prov√°vel: Furto (Top 1)" },
        "RESULT_2": { result: "Natureza Prov√°vel: Roubo (Top 2)" },
        "RESULT_3": { result: "Natureza Prov√°vel: Tr√°fico de Drogas (Top 3)" },
        "RESULT_4": { result: "Natureza Prov√°vel: Viol√™ncia Dom√©stica (Top 4)" },
        "RESULT_5": { result: "Natureza Prov√°vel: Homic√≠dio (Top 5)" },
        "RESULT_6": { result: "Natureza Prov√°vel: Feminic√≠dio (Top 6)" },
        "RESULT_7": { result: "Natureza Prov√°vel: Crimes Sexuais (Top 7)" },
        "RESULT_8": { result: "Natureza Prov√°vel: Crimes contra Crian√ßa/Adolescente (Top 8)" },
        "RESULT_9": { result: "Natureza Prov√°vel: Crime Organizado / Fac√ß√µes (Top 9)" },
        "RESULT_50": { result: "Perturba√ß√£o do Sossego (Art. 42 LCP) ‚Äì Enviar guarni√ß√£o se dispon√≠vel" },
        "RESULT_51": { result: "Orienta√ß√£o ao solicitante ‚Äì Sem envio de viatura" },
        "RESULT_52": { result: "Perturba√ß√£o do Sossego sem flagrante ‚Äì Orientar registro em delegacia online" },
        99: { result: "Fora do Top 10 ou informa√ß√µes insuficientes ‚Äì Encaminhar para triagem complementar" }
    }
};

// --- INICIALIZA√á√ÉO E FUN√á√ïES ---

document.addEventListener('DOMContentLoaded', () => {
    // Carrega a triagem imediatamente ao iniciar
    loadView('triagem');
});

function loadView(viewName) {
    appData.currentView = viewName;
    const flowDiv = document.getElementById('script-flow');
    const backBtn = document.getElementById('btn-back');

    if(viewName === 'triagem') {
        backBtn.style.display = 'none';
        appData.history = [1];
        renderNode(1);
    }
}

function renderNode(nodeId) {
    const node = appData.treeData[nodeId];
    const flowDiv = document.getElementById('script-flow');
    const backBtn = document.getElementById('btn-back');

    if(appData.history.length > 1) backBtn.style.display = 'inline-block';
    else backBtn.style.display = 'none';

    if(!node) {
        flowDiv.innerHTML = `<div class="alert alert-danger">Erro: N√≥ ${nodeId} n√£o encontrado.</div>`;
        return;
    }

    let html = '';

    if(node.result) {
        html = `
            <div class="system-alert">
                <i class="bi bi-check-circle-fill"></i> <strong>CLASSIFICA√á√ÉO FINAL:</strong><br>
                <span class="fs-5">${node.result}</span>
            </div>
            <div class="command-card">
                 <div class="command-text">Procedimento Encerrado</div>
                 <div class="command-hint">Copie as informa√ß√µes para o sistema de despacho (CAD).</div>
            </div>
            <div class="d-grid gap-2">
                <button class="btn btn-success p-3 fw-bold" onclick="resetApp()">‚úÖ FINALIZAR ATENDIMENTO</button>
            </div>
        `;
    } else {
        html = `
            <div class="command-card">
                <div class="command-text">${node.question}</div>
                ${node.guidance ? `<div class="command-hint">${node.guidance}</div>` : ''}
            </div>
        `;

        if (node.options) {
            html += `<div class="row g-2">`;
            node.options.forEach(opt => {
                html += `<div class="col-6">`;
                html += `<button class="option-btn" onclick="selectOption('${nodeId}', '${opt.next}', '${opt.text}')">
                    <i class="bi bi-chevron-right text-primary"></i> ${opt.text}
                </button>`;
                html += `</div>`;
            });
            html += `</div>`;
        }
    }

    flowDiv.innerHTML = html;
}

function selectOption(currentNodeId, nextNodeId, text) {
    logToNotepad(`> ${text}`);
    appData.history.push(nextNodeId);
    renderNode(nextNodeId);
}

function backStep() {
    if(appData.history.length > 1) {
        appData.history.pop();
        const previousNode = appData.history[appData.history.length - 1];
        renderNode(previousNode);
        
        // Remove √∫ltima linha do notepad
        const pad = document.getElementById('notepad');
        const lines = pad.value.trim().split('\n');
        if(lines.length > 0) {
            lines.pop();
            pad.value = lines.join('\n') + (lines.length ? '\n' : '');
        }
    }
}

function resetApp() {
    if(confirm("Reiniciar o atendimento?")) {
        document.getElementById('notepad').value = '';
        loadView('triagem');
    }
}

function logToNotepad(t) { 
    const p = document.getElementById('notepad'); 
    p.value += `${t}\n`; 
    p.scrollTop = p.scrollHeight; 
}

function copyNotes() { 
    const p = document.getElementById('notepad'); 
    p.select(); 
    navigator.clipboard.writeText(p.value); 
}

function clearNotes() { 
    if(confirm("Limpar notas?")) document.getElementById('notepad').value=''; 
}

</script>
</body>
</html>